(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j,F,I,q,R,U,z,W,X,V,$,J,K,Q,G,Y,Z,et,tt,nt={}.hasOwnProperty,rt=function(e,t){function r(){this.constructor=e}for(var n in t)nt.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e},it=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};this.particlejs||(this.particlejs={}),z=function(){function e(){this.listeners=[]}return e.prototype.add=function(e,t,n){n==null&&(n=0);if(!this.registered(e,t))return this.listeners.push([e,t,!1,n]),this.sortListeners()},e.prototype.addOnce=function(e,t,n){n==null&&(n=0);if(!this.registered(e,t))return this.listeners.push([e,t,!0,n]),this.sortListeners()},e.prototype.remove=function(e,t){if(this.registered(e,t))return this.listeners.splice(this.indexOf(e,t),1)},e.prototype.removeAll=function(){return this.listeners=[]},e.prototype.indexOf=function(e,t){var n,r,i,s,o,u,a;u=this.listeners;for(r=s=0,o=u.length;s<o;r=++s){a=u[r],i=a[0],n=a[1];if(e===i&&t===n)return r}return-1},e.prototype.registered=function(e,t){return this.indexOf(e,t)!==-1},e.prototype.sortListeners=function(){if(this.listeners.length<=1)return;return this.listeners.sort(function(e,t){var n,r,i;return i=[e[3],t[3]],n=i[0],r=i[1],n<r?1:r<n?-1:0})},e.prototype.dispatch=function(){var e,t,n,r,i,s,o,u,a;n=this.listeners.concat(),a=[];for(s=0,o=n.length;s<o;s++)u=n[s],t=u[0],e=u[1],r=u[2],i=u[3],t.apply(e,arguments),r?a.push(this.remove(t,e)):a.push(void 0);return a},e}(),tt=(typeof window!="undefined"&&window!==null?window.requestAnimationFrame:void 0)||(typeof window!="undefined"&&window!==null?window.webkitRequestAnimationFrame:void 0)||(typeof window!="undefined"&&window!==null?window.mozRequestAnimationFrame:void 0)||(typeof window!="undefined"&&window!==null?window.oRequestAnimationFrame:void 0)||(typeof window!="undefined"&&window!==null?window.msRequestAnimationFrame:void 0)||function(e){return setTimeout(e,1e3/60)},p=function(e){function t(e){this.timeScale=e!=null?e:1,t.__super__.constructor.call(this),this.running=!1}return rt(t,e),t.instance=function(){return this._instance||(this._instance=new t)},t.prototype.add=function(e,n,r){r==null&&(r=0),t.__super__.add.call(this,e,n,r);if(this.hasListeners()&&!this.running)return this.start()},t.prototype.remove=function(e,n,r){r==null&&(r=0),t.__super__.remove.call(this,e,n,r);if(this.running&&!this.hasListeners())return this.stop()},t.prototype.hasListeners=function(){return this.listeners.length>0},t.prototype.start=function(){return this.running=!0,this.initRun()},t.prototype.stop=function(){return this.running=!1},t.prototype.initRun=function(){var e=this;return this.time=this.getTime(),tt(function(){return e.run()})},t.prototype.run=function(){var e,t,n,r;if(this.running)return(n=this.stats)!=null&&n.begin(),t=this.getTime(),e=(t-this.time)*this.timeScale,this.dispatch(e,e/1e3,t),this.initRun(),(r=this.stats)!=null?r.end():void 0},t.prototype.getTime=function(){return(new Date).getTime()},t}(z),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,K=function(){function e(e,t,n){this.initializer=e!=null?e:new A,this.action=t!=null?t:new C,this.subSystem=n,this.particlesCreated=new z,this.particlesDied=new z,this.emissionStarted=new z,this.emissionFinished=new z,this.particles=[],this.emissions=[]}return e.source="particlejs.System",Z([i("initializer","action","subSystem")])["in"](e),e.prototype.emit=function(e){return this.emissions.push(e),e.system=this,this.startEmission(e)},e.prototype.startEmission=function(e){return e.prepare(0,0,this.getTime()),this.created=[],this.died=[],this.running||this.start(),this.processEmission(e),this.emissionStarted.dispatch(this,e),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},e.prototype.start=function(){if(!this.running)return p.instance().add(this.tick,this),this.running=!0},e.prototype.stop=function(){if(this.running)return p.instance().remove(this.tick,this),this.running=!1},e.prototype.tick=function(e,t,n){return this.died=[],this.created=[],this.processParticles(e,t,n),this.emitting()&&this.processEmissions(e,t,n),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},e.prototype.emitting=function(){return this.emissions.length>0},e.prototype.processEmissions=function(e,t,n){var r,i,s,o,u;o=this.emissions.concat(),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],r.prepare(e,t,n),u.push(this.processEmission(r));return u},e.prototype.processEmission=function(e){var t,n,r;r=[];while(e.hasNext())n=e.nextTime(),t=e.next(),this.created.push(t),this.registerParticle(t),this.initializeParticle(t,n),e.finished()?(this.removeEmission(e),r.push(this.emissionFinished.dispatch(this,e))):r.push(void 0);return r},e.prototype.removeEmission=function(e){return this.emissions.splice(this.emissions.indexOf(e),1)},e.prototype.processParticles=function(e,t,n){var r,i,s,o;this.action.prepare(e,t,n),o=this.particles.concat();for(i=0,s=o.length;i<s;i++)r=o[i],this.action.process(r),r.dead&&this.unregisterParticle(r)},e.prototype.initializeParticle=function(e,t){this.initializer.initialize(e),this.action.prepare(t,t/1e3,this.getTime()),this.action.process(e);if(e.dead)return this.unregisterParticle(e)},e.prototype.registerParticle=function(e){return this.particles.push(e)},e.prototype.unregisterParticle=function(e){var t;return this.died.push(e),(t=this.subSystem)!=null&&t.emitFor(e),this.particles.splice(this.particles.indexOf(e),1),e.constructor.release(e)},e.prototype.getTime=function(){return(new Date).valueOf()},e.prototype.compile=function(){return"(function(){\nvar CustomSystem,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCustomSystem = (function(_super) {\n\n  __extends(CustomSystem, _super);\n\n  function CustomSystem(){\n    CustomSystem.__super__.constructor.call(this);\n    "+this.initializer.sourceFragment("constructor")+"\n    "+this.action.sourceFragment("constructor")+"\n    this.subSystem = (function() {\n      // TODO\n    })();\n  };\n\n  CustomSystem.prototype.initializeParticle = function(particle, bias){\n    var biasInSeconds = bias / 1000, time = this.getTime();\n    "+this.initializer.sourceFragment("initialize")+"\n  };\n\n  CustomSystem.prototype.processParticles = function(bias, biasInSeconds, time){\n    var particle, _i, _len, _ref;\n    "+this.action.sourceFragment("prepare")+"\n\n    _ref = this.particles.concat();\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      particle = _ref[_i];\n      "+this.action.sourceFragment("process")+"\n      if (particle.dead) {\n        this.unregisterParticle(particle)\n      }\n    }\n  };\n\n})(particlejs.System);\n\nreturn new CustomSystem;\n})()"},e.prototype.toSource=function(){var e;return e=this.getArgumentsSource(),"new "+this.constructor.source+"("+e.join(",")+")"},e.prototype.getArgumentsSource=function(){var e=this;return["initializer","action","subSystem"].select(function(t){return e[t]!=null}).map(function(t){return e[t].toSource()})},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,$=function(e){function t(e,n,r,i){this.emissionFactory=r,t.__super__.constructor.call(this,e,n,i)}return rt(t,e),t.source="particlejs.SubSystem",Z([i("initializer","action","subSystem")])["in"](t),t.prototype.emitFor=function(e){return this.emit(this.emissionFactory(e))},t.prototype.compile=function(){return"(function(){\nvar CustomSubSystem,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCustomSubSystem = (function(_super) {\n\n  __extends(CustomSubSystem, _super);\n\n  function CustomSubSystem(){\n    CustomSubSystem.__super__.constructor.call(this);\n    "+this.initializer.sourceFragment("constructor")+"\n    "+this.action.sourceFragment("constructor")+"\n    this.emissionFactory = "+this.emissionFactory.toString()+";\n  };\n\n  CustomSubSystem.prototype.initializeParticle = function(particle, bias){\n    var biasInSeconds = bias / 1000, time = this.getTime();\n    "+this.initializer.sourceFragment("initialize")+"\n  };\n\n  CustomSubSystem.prototype.processParticles = function(bias, biasInSeconds, time){\n    var particle, _i, _len, _ref;\n\n    "+this.action.sourceFragment("prepare")+"\n    _ref = this.particles.concat();\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      particle = _ref[_i];\n      "+this.action.sourceFragment("process")+"\n      if (particle.dead) {\n        this.unregisterParticle(particle)\n      }\n    }\n  };\n\n})(particlejs.SubSystem);\n\nreturn new CustomSubSystem;\n})()"},t.prototype.getArgumentsSource=function(){var e=this;return["initializer","action","emissionFactory","subSystem"].select(function(t){return e[t]!=null}).map(function(t){return e[t].toSource!=null?e[t].toSource():e[t].toString()})},t}(K),T=mixinsjs.Mixin,e=function(e){return e.split(/\s+/g)},m=e("biasInSeconds bias time nextTime"),F=e("finished get"),u=function(){return/^function\s*([^(]+\s*)*\([^)]*\)\s*\{\}/gm},U=function(){return/(^\s*|\s*$)/gm},I=function(){return/return\s*([^;]+);/gm},Q=function(){return RegExp("this\\.("+m.join("|")+")","gm")},g=function(){var e;return e=m.map(function(e){return""+e+"\\s*=\\s*"+e}),RegExp("("+e.join("|")+");","gm")},d=function(e){var t;return e==null&&(e={}),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return rt(n,t),n.prototype.sourceFragment=function(t){var n,r,i,s,o,a,f,l,c,h,p,d,v,y,b,w=this;s=t==="constructor",c=this[t],s&&e["super"]&&(c=c.__super__.constructor),h=!1,((v=e.mapSource)!=null?v[t]:void 0)!=null&&(!s||e.mapSource[t]!==Object)&&(c=e.mapSource[t],typeof c=="function"&&(c=c.call(this)),h=!0);if(!h){c=c.toString();if(u().test(c))return"";if(s&&e.noconstructor)return"";r=c.split("\n"),r.shift(),r.pop(),s&&(r=r.filter(function(e){return!RegExp(""+m.join("|")).test(e)})),c=r.join("\n")}i=function(e){return Object.prototype.toString.call(e).indexOf("Array")!==-1},p=function(e){var t;return e.toSource!=null&&(t=typeof e)!=="string"&&t!=="number"?e.toSource():i(e)&&e.toSource==null?"["+e.map(function(e){return p(e)}).join(",")+"]":e},a=function(t){var n;return n=RegExp("this\\.("+e.inlinedProperties.join("|")+")\\s*=[^=]+[^\\n]+","g"),t.replace(n,"")},f=function(t){var n;return n=RegExp("this\\.("+e.inlinedProperties.join("|")+")","g"),t.replace(n,function(e,t){return p(w[t])})},l=function(e){var t;return t=/@([$A-Za-z_][$A-Za-z0-9_]*)/g,e.replace(t,function(e,t){return p(w[t])})},c=c.replace(Q(),"$1").replace(g(),""),e.keywords!=null&&(n=RegExp("this\\.("+e.keywords.join("|")+")","gm"),c=c.replace(n,"$1")),e.inlinedProperties!=null&&(c=a(c),c=f(c)),c=l(c);if(e.rename!=null){y=e.rename;for(o in y)d=y[o],c=c.replace(RegExp(""+o,"g"),d)}if((b=e.keepReturn)!=null?!b[t]:!void 0)it.call(F,t)>=0?c=c.replace(I(),""+t+" = $1;"):c=c.replace(I(),"$1;");return c.replace(U(),"")},n}(T)},T=mixinsjs.Mixin,j=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return rt(t,e),t.included=function(e){return e.resetPools=function(){return this.allocated=[],this.pooled=[]},e.get=function(t){var n,r,i;t==null&&(t={}),this.pooled.length>0?n=this.pooled.shift():n=new e,typeof n.init=="function"&&n.init();for(r in t)i=t[r],n[r]=i;return this.allocated.push(n),n},e.release=function(e){var t;return t=this.allocated.indexOf(e),e.dispose(),this.allocated.splice(t,1),this.pooled.push(e)},e.resetPools()},t}(T),T=mixinsjs.Mixin,q=chancejs.Random,x=chancejs.MathRandom,s=new q(new x),R=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return rt(t,e),t.prototype.initRandom=function(){return this.random||(this.random=s)},t}(T),n=function(){function e(){}return e.prototype.prepare=function(e,t,n){this.bias=e,this.biasInSeconds=t,this.time=n},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,o=function(){function e(e){this.surfaces=e,Object.prototype.toString.call(this.surface).indexOf("Array")===-1&&(this.surfaces=[this.surfaces])}return Z([d({mapSource:{constructor:"this.deathSurfaces = @surfaces;"},rename:{"return p\\.die\\(\\);":"p.die(); break;",surfaces:"deathSurfaces"}}),i("surfaces"),W("particlejs.DieOnSurface","surfaces")])["in"](e),e.prototype.prepare=function(){},e.prototype.process=function(e){var t,n,r,i;i=this.surfaces;for(n=0,r=i.length;n<r;n++){t=i[n];if(t.contains(e.position))return e.die()}},e}(),H=geomjs.Point,W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,c=function(e){function t(e){this.vector=e!=null?e:new H}return rt(t,e),Z([d({rename:{vector:"forceVector"},mapSource:{constructor:"this.vector = @vector;"}}),i("vector"),W("particlejs.Force","vector")])["in"](t),t.prototype.process=function(e){return e.velocity.x+=this.vector.x*this.biasInSeconds,e.velocity.y+=this.vector.y*this.biasInSeconds},t}(n),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,h=function(e){function t(e){this.amount=e!=null?e:1}return rt(t,e),Z([d({noconstructor:!0,inlinedProperties:["amount"]}),i("amount"),W("particlejs.Friction","amount")])["in"](t),t.prototype.process=function(e){return e.velocity.x-=e.velocity.x*this.biasInSeconds*this.amount,e.velocity.y-=e.velocity.y*this.biasInSeconds*this.amount},t}(n),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,w=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return rt(t,e),Z([d({noconstructor:!0}),i(),W("particlejs.Live")])["in"](t),t.prototype.process=function(e){e.life+=this.bias;if(e.life>=e.maxLife)return e.die()},t}(n),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,et=function(e){return function(){var t=this;return this.actions.map(function(t){var n,r;return r=t.sourceFragment!=null?t.sourceFragment(e):t[e]===Object?"":(n=t[e].toString().split("\n"),n.shift(),n.pop(),n.join("\n"))}).join("\n")}},E=function(e){function t(e){this.actions=e!=null?e:[]}return rt(t,e),Z([d({mapSource:{constructor:function(){return et("constructor").call(this)},prepare:function(){return et("prepare").call(this)},process:function(){return et("process").call(this)}}}),i("actions"),W("particlejs.MacroAction","actions")])["in"](t),t.prototype.prepare=function(e,t,n){var r,i,s,o,u;o=this.actions,u=[];for(i=0,s=o.length;i<s;i++)r=o[i],u.push(r.prepare(e,t,n));return u},t.prototype.process=function(e){var t,n,r,i,s;i=this.actions,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.process(e));return s},t}(n),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,N=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return rt(t,e),Z([d({noconstructor:!0}),i(),W("particlejs.Move")])["in"](t),t.prototype.process=function(e){return e.lastPosition.x=e.position.x,e.lastPosition.y=e.position.y,e.position.x+=e.velocity.x*this.biasInSeconds,e.position.y+=e.velocity.y*this.biasInSeconds},t}(n),C=function(){function e(){}return e.prototype.prepare=function(){},e.prototype.process=function(){},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,r=function(){function e(e){this.rate=e!=null?e:1,this.count=0,this.rest=0,this.offset=1}return Z([d({inlinedProperties:["rate"],keywords:["count"],mapSource:{constructor:"this.rest = @rest;\nthis.offset = @offset;"}}),i("rate"),W("particlejs.ByRate","rate")])["in"](e),e.prototype.prepare=function(e,t,n){return this.rest+=t*this.rate,this.count=Math.floor(this.rest),this.rest-=this.count,this.count+=this.offset,this.offset=0},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,l=function(){function e(e){this.count=e!=null?e:1}return Z([d({inlinedProperties:["count"],mapSource:{prepare:"count = this.count;"}}),i("count"),W("particlejs.Fixed","count")])["in"](e),e.prototype.prepare=function(){},e}(),k=function(){function e(){}return e.prototype.count=0,e.prototype.prepare=function(){},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,M=["particleType","emitter","timer","counter","initializer"],a=function(){function e(e,t,n,r,i){this.particleType=e!=null?e:_,this.emitter=t!=null?t:new L,this.timer=n!=null?n:new O,this.counter=r!=null?r:new k,this.initializer=i!=null?i:null}return e.source="particlejs.Emission",Z([i.apply(null,M)])["in"](e),e.prototype.prepare=function(e,t,n){var r;return this.timer.prepare(e,t,n),r=this.timer.nextTime,this.counter.prepare(r,r/1e3,n),this.currentCount=this.counter.count,this.currentTime=r,this.iterator=0},e.prototype.hasNext=function(){return this.iterator<this.currentCount},e.prototype.next=function(){var e,t;return e=this.particleType.get({position:this.emitter.get()}),(t=this.initializer)!=null&&t.initialize(e),this.iterator++,e},e.prototype.nextTime=function(){return this.currentTime-this.iterator/this.currentCount*this.currentTime},e.prototype.finished=function(){return this.timer.finished()},e.prototype.compile=function(){var e,t,n,r,i,s,o,u,a;return"(function(){\n  var emission = {\n    init: function(){\n      "+((e=this.emitter)!=null?e.sourceFragment("constructor"):void 0)+"\n      "+((t=this.timer)!=null?t.sourceFragment("constructor"):void 0)+"\n      "+((n=this.counter)!=null?n.sourceFragment("constructor"):void 0)+"\n      "+((r=this.initializer)!=null?r.sourceFragment("constructor"):void 0)+"\n    },\n    prepare: function(bias, biasInSeconds, time) {\n      this.iterator = 0;\n      var count = 0, nextTime = 0;\n\n      "+((i=this.timer)!=null?i.sourceFragment("prepare"):void 0)+"\n\n      "+((s=this.counter)!=null?s.sourceFragment("prepare"):void 0)+"\n\n      this._nextTime = nextTime;\n      this.count = count;\n    },\n    hasNext: function(){\n      return this.iterator < this.count;\n    },\n    next: function(){\n      var get, particle;\n      "+((o=this.emitter)!=null?o.sourceFragment("get"):void 0)+"\n\n      particle = particlejs.Particle.get({position: get});\n      particle.position.x = get.x;\n      particle.position.y = get.y;\n\n      "+((u=this.initializer)!=null?u.sourceFragment("initialize"):void 0)+"\n\n      this.iterator++;\n      return particle;\n    },\n    nextTime: function(){\n      return this._nextTime;\n    },\n    finished: function(){\n      var finished = true;\n\n      "+((a=this.timer)!=null?a.sourceFragment("finished"):void 0)+"\n\n      return finished;\n    }\n  };\n  emission.init();\n  return emission;\n})()"},e.prototype.toSource=function(){var e;return e=this.getArgumentsSource(),"new "+this.constructor.source+"("+e.join(",")+")"},e.prototype.getArgumentsSource=function(){var e,t=this;return e=[this.particleType.source],["emitter","timer","counter","initializer"].forEach(function(n){return e.push(t[n].toSource())}),e},e}(),H=geomjs.Point,L=function(){function e(){}return e.prototype.get=function(){return new H},e}(),P=function(){function e(e,t){this.path=e,this.random=t,this.initRandom()}return R.attachTo(e),e.prototype.get=function(){return this.path.pathPointAt(this.random.get())},e}(),H=geomjs.Point,W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,B=function(){function e(e){this.point=e!=null?e:new H}return Z([d({noconstructor:!0,inlinedProperties:["point"],mapSource:{get:"return this.point;"}}),i("point"),W("particlejs.Ponctual","point")])["in"](e),e.prototype.get=function(){return this.point.clone()},e}(),J=function(){function e(e,t){this.surface=e,this.random=t,this.initRandom()}return R.attachTo(e),e.prototype.get=function(){return this.surface.randomPointInSurface(this.random)},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,M=["velocityMin","velocityMax","angleMin","angleMax"],f=function(){function e(e,t,n,r,i){this.velocityMin=e!=null?e:0,this.velocityMax=t!=null?t:1,this.angleMin=n!=null?n:0,this.angleMax=r!=null?r:Math.PI*2,this.random=i,this.initRandom()}return Z([d({inlinedProperties:M,rename:{random:"explosionRandom"},mapSource:{constructor:"this.random = @random;"}}),i.apply(null,M.concat("random")),W.apply(null,["particlejs.Explosion"].concat(M).concat("random")),R])["in"](e),e.prototype.initialize=function(e){var t,n;return t=this.random["in"](this.angleMin,this.angleMax),n=this.random["in"](this.velocityMin,this.velocityMax),e.velocity.x=Math.cos(t)*n,e.velocity.y=Math.sin(t)*n},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,y=function(){function e(e,t,n){this.lifeMin=e,this.lifeMax=t,this.random=n,this.lifeMax==null&&(this.lifeMax=this.lifeMin),this.initRandom()}return Z([d({inlinedProperties:["lifeMin","lifeMax"],rename:{random:"lifeRandom"},mapSource:{constructor:"this.random = @random;",initialize:function(){return this.lifeMax===this.lifeMin?"particle.maxLife = @lifeMin;":'particle.maxLife = this.random["in"](@lifeMin, @lifeMax);'}}}),i("lifeMin","lifeMax","random"),W("particlejs.Life","lifeMin","lifeMax","random"),R])["in"](e),e.prototype.initialize=function(e){return this.lifeMin===this.lifeMax?e.maxLife=this.lifeMin:e.maxLife=this.random["in"](this.lifeMin,this.lifeMax)},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,et=function(e){return function(){var t=this;return this.initializers.map(function(t){var n,r;return r=t.sourceFragment!=null?t.sourceFragment(e):t[e]===Object?"":(n=t[e].toString().split("\n"),n.shift(),n.pop(),n.join("\n"))}).join("\n")}},S=function(){function e(e){this.initializers=e}return Z([d({mapSource:{constructor:function(){return et("constructor").call(this)},initialize:function(){return et("initialize").call(this)}}}),i("initializers")])["in"](e),e.prototype.initialize=function(e){var t,n,r,i,s;i=this.initializers,s=[];for(n=0,r=i.length;n<r;n++)t=i[n],s.push(t.initialize(e));return s},e.prototype.toSource=function(){var e,t;return e="particlejs.MacroInitializer",t=this.initializers.map(function(e){return e.toSource!=null?e.toSource():e}),"new "+e+"(["+t.join(",")+"])"},e}(),A=function(){function e(){}return e.prototype.initialize=function(){},e}(),D=function(){function e(e,t,n,r){this.subSystem=new $(e,t,n,r)}return e.prototype.initialize=function(e){return this.subSystem.emitFor(e)},e}(),H=geomjs.Point,W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,M=["velocityMin","velocityMax","angleRandom"],t=["direction"].concat(M).concat("random"),X=function(){function e(e,t,n,r,i){this.direction=e!=null?e:new H(1,1),this.velocityMin=t!=null?t:0,this.velocityMax=n!=null?n:1,this.angleRandom=r!=null?r:0,this.random=i,this.initRandom()}return Z([d({inlinedProperties:M,rename:{random:"streamRandom"},mapSource:{constructor:"this.direction = @direction;\nthis.random = @random;"}}),i.apply(null,t),W.apply(null,["particlejs.Stream"].concat(t)),R])["in"](e),e.prototype.initialize=function(e){var t,n;return n=this.random["in"](this.velocityMin,this.velocityMax),t=this.direction.angle(),this.angleRandom!==0&&(t+=this.random.pad(this.angleRandom)),e.velocity.x=Math.cos(t)*n,e.velocity.y=Math.sin(t)*n},e}(),H=geomjs.Point,_=function(){function e(){}return e.source="particlejs.Particle",j.attachTo(e),e.prototype.init=function(){return this.dead=!1,this.life=0,this.maxLife=0,this.position=new H,this.lastPosition=new H,this.velocity=new H,this.parasite={}},e.prototype.dispose=function(){return this.position=null,this.lastPosition=null,this.velocity=null,this.parasite=null},e.prototype.die=function(){return this.dead=!0,this.life=this.maxLife},e.prototype.revive=function(){return this.dead=!1,this.life=0},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,V=function(e){function t(e,n,r,i,s,o){this.particle=e,t.__super__.constructor.call(this,n,r,i,s,o)}return rt(t,e),t.source="particlejs.SubEmission",t.prototype.getArgumentsSource=function(){var e,t=this;return e=["null",this.particleType.source],["emitter","timer","counter","initializer"].forEach(function(n){return e.push(t[n].toSource())}),e},t}(a),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,$=function(e){function t(e,n,r,i){this.emissionFactory=r,t.__super__.constructor.call(this,e,n,i)}return rt(t,e),t.source="particlejs.SubSystem",Z([i("initializer","action","subSystem")])["in"](t),t.prototype.emitFor=function(e){return this.emit(this.emissionFactory(e))},t.prototype.compile=function(){return"(function(){\nvar CustomSubSystem,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCustomSubSystem = (function(_super) {\n\n  __extends(CustomSubSystem, _super);\n\n  function CustomSubSystem(){\n    CustomSubSystem.__super__.constructor.call(this);\n    "+this.initializer.sourceFragment("constructor")+"\n    "+this.action.sourceFragment("constructor")+"\n    this.emissionFactory = "+this.emissionFactory.toString()+";\n  };\n\n  CustomSubSystem.prototype.initializeParticle = function(particle, bias){\n    var biasInSeconds = bias / 1000, time = this.getTime();\n    "+this.initializer.sourceFragment("initialize")+"\n  };\n\n  CustomSubSystem.prototype.processParticles = function(bias, biasInSeconds, time){\n    var particle, _i, _len, _ref;\n\n    "+this.action.sourceFragment("prepare")+"\n    _ref = this.particles.concat();\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      particle = _ref[_i];\n      "+this.action.sourceFragment("process")+"\n      if (particle.dead) {\n        this.unregisterParticle(particle)\n      }\n    }\n  };\n\n})(particlejs.SubSystem);\n\nreturn new CustomSubSystem;\n})()"},t.prototype.getArgumentsSource=function(){var e=this;return["initializer","action","emissionFactory","subSystem"].select(function(t){return e[t]!=null}).map(function(t){return e[t].toSource!=null?e[t].toSource():e[t].toString()})},t}(K),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,K=function(){function e(e,t,n){this.initializer=e!=null?e:new A,this.action=t!=null?t:new C,this.subSystem=n,this.particlesCreated=new z,this.particlesDied=new z,this.emissionStarted=new z,this.emissionFinished=new z,this.particles=[],this.emissions=[]}return e.source="particlejs.System",Z([i("initializer","action","subSystem")])["in"](e),e.prototype.emit=function(e){return this.emissions.push(e),e.system=this,this.startEmission(e)},e.prototype.startEmission=function(e){return e.prepare(0,0,this.getTime()),this.created=[],this.died=[],this.running||this.start(),this.processEmission(e),this.emissionStarted.dispatch(this,e),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},e.prototype.start=function(){if(!this.running)return p.instance().add(this.tick,this),this.running=!0},e.prototype.stop=function(){if(this.running)return p.instance().remove(this.tick,this),this.running=!1},e.prototype.tick=function(e,t,n){return this.died=[],this.created=[],this.processParticles(e,t,n),this.emitting()&&this.processEmissions(e,t,n),this.created.length>0&&this.particlesCreated.dispatch(this,this.created),this.died.length>0&&this.particlesDied.dispatch(this,this.died),this.died=null,this.created=null},e.prototype.emitting=function(){return this.emissions.length>0},e.prototype.processEmissions=function(e,t,n){var r,i,s,o,u;o=this.emissions.concat(),u=[];for(i=0,s=o.length;i<s;i++)r=o[i],r.prepare(e,t,n),u.push(this.processEmission(r));return u},e.prototype.processEmission=function(e){var t,n,r;r=[];while(e.hasNext())n=e.nextTime(),t=e.next(),this.created.push(t),this.registerParticle(t),this.initializeParticle(t,n),e.finished()?(this.removeEmission(e),r.push(this.emissionFinished.dispatch(this,e))):r.push(void 0);return r},e.prototype.removeEmission=function(e){return this.emissions.splice(this.emissions.indexOf(e),1)},e.prototype.processParticles=function(e,t,n){var r,i,s,o;this.action.prepare(e,t,n),o=this.particles.concat();for(i=0,s=o.length;i<s;i++)r=o[i],this.action.process(r),r.dead&&this.unregisterParticle(r)},e.prototype.initializeParticle=function(e,t){this.initializer.initialize(e),this.action.prepare(t,t/1e3,this.getTime()),this.action.process(e);if(e.dead)return this.unregisterParticle(e)},e.prototype.registerParticle=function(e){return this.particles.push(e)},e.prototype.unregisterParticle=function(e){var t;return this.died.push(e),(t=this.subSystem)!=null&&t.emitFor(e),this.particles.splice(this.particles.indexOf(e),1),e.constructor.release(e)},e.prototype.getTime=function(){return(new Date).valueOf()},e.prototype.compile=function(){return"(function(){\nvar CustomSystem,\n  __hasProp = {}.hasOwnProperty,\n  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };\n\nCustomSystem = (function(_super) {\n\n  __extends(CustomSystem, _super);\n\n  function CustomSystem(){\n    CustomSystem.__super__.constructor.call(this);\n    "+this.initializer.sourceFragment("constructor")+"\n    "+this.action.sourceFragment("constructor")+"\n    this.subSystem = (function() {\n      // TODO\n    })();\n  };\n\n  CustomSystem.prototype.initializeParticle = function(particle, bias){\n    var biasInSeconds = bias / 1000, time = this.getTime();\n    "+this.initializer.sourceFragment("initialize")+"\n  };\n\n  CustomSystem.prototype.processParticles = function(bias, biasInSeconds, time){\n    var particle, _i, _len, _ref;\n    "+this.action.sourceFragment("prepare")+"\n\n    _ref = this.particles.concat();\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\n      particle = _ref[_i];\n      "+this.action.sourceFragment("process")+"\n      if (particle.dead) {\n        this.unregisterParticle(particle)\n      }\n    }\n  };\n\n})(particlejs.System);\n\nreturn new CustomSystem;\n})()"},e.prototype.toSource=function(){var e;return e=this.getArgumentsSource(),"new "+this.constructor.source+"("+e.join(",")+")"},e.prototype.getArgumentsSource=function(){var e=this;return["initializer","action","subSystem"].select(function(t){return e[t]!=null}).map(function(t){return e[t].toSource()})},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,v=function(){function e(){}return Z([d(),i(),W("particlejs.Instant")])["in"](e),e.prototype.prepare=function(){return this.nextTime=0},e.prototype.finished=function(){return!0},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,b=function(){function e(e,t){this.duration=e!=null?e:1e3,this.since=t!=null?t:0,this.elapsed=0,this.nextTime=0}return Z([d({inlinedProperties:["duration","since"]}),i("duration","since"),W("particlejs.Limited","duration","since")])["in"](e),e.prototype.prepare=function(e,t,n){return this.firstTime?this.nextTime=e:(this.nextTime=this.since+e,this.firstTime=!0),this.elapsed+=e},e.prototype.finished=function(){return this.elapsed>=this.duration},e}(),O=function(){function e(){}return e.prototype.nextTime=0,e.prototype.prepare=function(){},e.prototype.finished=function(){return!0},e}(),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,G=function(e){function t(e){t.__super__.constructor.call(this,Infinity,e)}return rt(t,e),Z([d({inlinedProperties:["duration","since"],"super":!0}),i("since"),W("particlejs.Unlimited","since")])["in"](t),t.prototype.finished=function(){return!1},t}(b),W=mixinsjs.Sourcable,i=mixinsjs.Cloneable,Z=mixinsjs.include,Y=function(){function e(e){this.particle=e}return Z([d({noconstructor:!0}),i("duration","particle"),W("particlejs.UntilDeath")])["in"](e),e.prototype.prepare=function(e,t,n){return this.nextTime=e},e.prototype.finished=function(){return this.particle.dead},e}(),this.particlejs.Signal=z,this.particlejs.Impulse=p,this.particlejs.System=K,this.particlejs.SubSystem=$,this.particlejs.Inlinable=d,this.particlejs.Poolable=j,this.particlejs.Randomizable=R,this.particlejs.BaseAction=n,this.particlejs.DieOnSurface=o,this.particlejs.Force=c,this.particlejs.Friction=h,this.particlejs.Live=w,this.particlejs.MacroAction=E,this.particlejs.Move=N,this.particlejs.NullAction=C,this.particlejs.ByRate=r,this.particlejs.Fixed=l,this.particlejs.NullCounter=k,this.particlejs.Emission=a,this.particlejs.NullEmitter=L,this.particlejs.Path=P,this.particlejs.Ponctual=B,this.particlejs.Surface=J,this.particlejs.Explosion=f,this.particlejs.Life=y,this.particlejs.MacroInitializer=S,this.particlejs.NullInitializer=A,this.particlejs.ParticleSubSystem=D,this.particlejs.Stream=X,this.particlejs.Particle=_,this.particlejs.SubEmission=V,this.particlejs.SubSystem=$,this.particlejs.System=K,this.particlejs.Instant=v,this.particlejs.Limited=b,this.particlejs.NullTimer=O,this.particlejs.Unlimited=G,this.particlejs.UntilDeath=Y}).call(this)