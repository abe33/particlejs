(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A=[].slice,O={}.hasOwnProperty,M=function(e,t){function r(){this.constructor=e}for(var n in t)O.call(t,n)&&(e[n]=t[n]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};this.geomjs||(this.geomjs={}),Math.PI2=Math.PI*2,Math.PI_2=Math.PI/2,Math.PI_4=Math.PI/4,Math.PI_8=Math.PI/8,Math.degToRad=function(e){return e*Math.PI/180},Math.radToDeg=function(e){return e*180/Math.PI},Math.normalize=function(e,t,n){return(e-t)/(n-t)},Math.interpolate=function(e,t,n){return t+(n-t)*e},Math.deltaBelowRatio=function(e,t,n){return n==null&&(n=1e10),Math.abs(e-t)<1/n},Math.map=function(e,t,n,r,i){return Math.interpolate(Math.normalize(e,t,n),r,i)},Math.isFloat=function(){var e,t,n,r;t=1<=arguments.length?A.call(arguments,0):[];for(n=0,r=t.length;n<r;n++){e=t[n];if(isNaN(parseFloat(e)))return!1}return!0},Math.isInt=function(){var e,t,n,r;t=1<=arguments.length?A.call(arguments,0):[];for(n=0,r=t.length;n<r;n++){e=t[n];if(isNaN(parseInt(e)))return!1}return!0},Math.asFloat=function(){var e,t,n,r,i;e=1<=arguments.length?A.call(arguments,0):[];for(t=r=0,i=e.length;r<i;t=++r)n=e[t],e[t]=parseFloat(n);return e},Math.asInt=function(){var e,t,n,r,i;t=1<=arguments.length?A.call(arguments,0):[];for(e=r=0,i=t.length;r<i;e=++r)n=t[e],t[e]=parseInt(n);return t},L=function(){var e;return e=1<=arguments.length?A.call(arguments,0):[],Object.prototype.toString.call(e[0]).indexOf("Array")>=0&&(e=e[0]),{"in":function(t){return e.forEach(function(e){return e.attachTo(t)})}}},h=function(){function e(){}return e.attachTo=function(e){var t,n,r;r=this.prototype;for(t in r)n=r[t],t!=="constructor"&&(e.prototype[t]=n);return typeof this.included=="function"?this.included(e):void 0},e}(),s=function(){var e,t;return t=1<=arguments.length?A.call(arguments,0):[],e=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return M(n,e),n.prototype.equals=function(e){var n=this;return e!=null&&t.every(function(t){return n[t].equals!=null?n[t].equals(e[t]):e[t]===n[t]})},n}(h)},o=function(){var e,t,n;return t=arguments[0],n=2<=arguments.length?A.call(arguments,1):[],e=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return M(r,e),r.prototype.toString=function(){var e,r;return n.length===0?"["+t+"]":(e=function(){var e,t,i;i=[];for(e=0,t=n.length;e<t;e++)r=n[e],i.push(""+r+"="+this[r]);return i}.call(this),"["+t+"("+e.join(", ")+")]")},r.prototype.classname=function(){return t},r}(h)},t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.included=function(e){return e.prototype.clone=function(){return new e(this)}},t}(h),E=function(){var e,t,n;return t=arguments[0],n=2<=arguments.length?A.call(arguments,1):[],e=function(e){function r(){return r.__super__.constructor.apply(this,arguments)}return M(r,e),r.prototype.toSource=function(){var e,r;return r=function(){var t,r,i;i=[];for(t=0,r=n.length;t<r;t++)e=n[t],i.push(this[e]);return i}.call(this).map(function(e){var t;switch(typeof e){case"object":return t=Object.prototype.toString.call(e).indexOf("Array")!==-1,e.toSource!=null?e.toSource():t?"["+e.map(function(e){return e.toSource!=null?e.toSource():e})+"]":e;case"string":return e.toSource!=null?e.toSource():"'"+e.replace("'","\\'")+"'";default:return e}}),"new "+t+"("+r.join(",")+")"},r}(h)},c=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.prototype.memoized=function(e){var t;return this.memoizationKey()===this.__memoizationKey__?((t=this.__memo__)!=null?t[e]:void 0)!=null:(this.__memo__={},!1)},t.prototype.memoFor=function(e){return this.__memo__[e]},t.prototype.memoize=function(e,t){return this.__memo__||(this.__memo__={}),this.__memoizationKey__=this.memoizationKey(),this.__memo__[e]=t},t.prototype.memoizationKey=function(){return this.toString()},t}(h),p=function(e,t,n){var r;return n==null&&(n=!1),r=function(r){function i(){return i.__super__.constructor.apply(this,arguments)}return M(i,r),i.included=function(r){var i;return i=function(){var e,r,i,s,o,u,a,f,l,c,h;e=2<=arguments.length?A.call(arguments,0,h=arguments.length-1):(h=0,[]),f=arguments[h++],typeof f=="number"&&(e.push(f),f=!1),a={},u=arguments[0],o=0,r=u!=null&&typeof u=="object";for(i in t){l=t[i],c=r?u[i]:arguments[o++],a[i]=parseFloat(c);if(isNaN(a[i])){if(f)throw s=function(){var e,n,r;r=[];for(e=0,n=t.length;e<n;e++)i=t[e],r.push(i);return r}().join(", "),new Error(""+a+" doesn't match pattern {"+s+"}");n?delete a[i]:a[i]=l}}return a},r[e]=i,r.prototype[e]=i},i}(h)},u=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}var t;return M(n,e),n.prototype.points=function(){},n.prototype.closedGeometry=function(){return!1},t=function(e,t,n){return Math[t].apply(Math,e.map(function(e){return e[n]}))},n.prototype.top=function(){return t(this.points(),"min","y")},n.prototype.bottom=function(){return t(this.points(),"max","y")},n.prototype.left=function(){return t(this.points(),"min","x")},n.prototype.right=function(){return t(this.points(),"max","x")},n.prototype.bounds=function(){return{top:this.top(),left:this.left(),right:this.right(),bottom:this.bottom()}},n.prototype.boundingBox=function(){return new w(this.left(),this.top(),this.right()-this.left(),this.bottom()-this.top())},n.prototype.stroke=function(e,t){t==null&&(t="#ff0000");if(e==null)return;return e.strokeStyle=t,this.drawPath(e),e.stroke()},n.prototype.fill=function(e,t){t==null&&(t="#ff0000");if(e==null)return;return e.fillStyle=t,this.drawPath(e),e.fill()},n.prototype.drawPath=function(e){var t,n,r,i,s;n=this.points(),r=n.shift(),e.beginPath(),e.moveTo(r.x,r.y);for(i=0,s=n.length;i<s;i++)t=n[i],e.lineTo(t.x,t.y);return e.closePath()},n}(h),T=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.prototype.acreage=function(){return null},t.prototype.randomPointInSurface=function(){return null},t.prototype.contains=function(e,t){return null},t.prototype.containsGeometry=function(e){var t=this;return e.points().every(function(e){return t.contains(e)})},t}(h),d=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.prototype.length=function(){return null},t.prototype.pathPointAt=function(e,t){var n;return t==null&&(t=!0),e<0&&(e=0),e>1&&(e=1),n=this.points(),e===0?n[0]:e===1?n[n.length-1]:t?this.walkPathBasedOnLength(e,n):this.walkPathBasedOnSegments(e,n)},t.prototype.pathOrientationAt=function(e,t){var n,r,i;return t==null&&(t=!0),r=this.pathPointAt(e-.01,t),i=this.pathPointAt(e+.01,t),n=i.subtract(r),n.angle()},t.prototype.pathTangentAt=function(e,t,n){return t==null&&(t=.01),n==null&&(n=!0),this.pathPointAt((e+t)%1,n).subtract(this.pathPointAt((1+e-t)%1),n).normalize(1)},t.prototype.walkPathBasedOnLength=function(e,t){var n,r,i,s,o,u,a,f,l;a=0,i=this.length();for(n=f=1,l=t.length-1;1<=l?f<=l:f>=l;n=1<=l?++f:--f){s=t[n-1],o=t[n],u=s.distance(o)/i;if(a+u>e)return r=Math.map(e,a,a+u,0,1),this.pointInSegment(r,[s,o]);a+=u}},t.prototype.walkPathBasedOnSegments=function(e,t){var n,r;return r=t.length-1,e*=r,n=Math.floor(e),n===r&&(n-=1),this.pointInSegment(e-n,t.slice(n,+(n+1)+1||9e9))},t.prototype.pointInSegment=function(e,t){return t[0].add(t[1].subtract(t[0]).scale(e))},t}(h),a=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.iterators={},t.prototype.intersects=function(e){var t,n;return e.bounds!=null&&!this.boundsCollide(e)?!1:(n=!1,t=this.intersectionsIterator(this,e),t.call(this,this,e,function(){return n=!0}),n)},t.prototype.intersections=function(e){var t,n;return e.bounds!=null&&!this.boundsCollide(e)?null:(n=[],t=this.intersectionsIterator(this,e),t.call(this,this,e,function(e){return n.push(e),!1}),n.length>0?n:null)},t.prototype.boundsCollide=function(e){var t,n;return t=this.bounds(),n=e.bounds(),!(t.top>n.bottom||t.left>n.right||t.bottom<n.top||t.right<n.left)},t.prototype.intersectionsIterator=function(e,n){var r,i,s;return r=e.classname?e.classname():"",i=n.classname?n.classname():"",s=null,s=t.iterators[r+i],s||(s=t.iterators[r]),s||(s=t.iterators[i]),s||this.eachIntersections},t.prototype.eachIntersections=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;r==null&&(r=!1),b=e.points(),w=t.points(),g=b.length,y=w.length,m=null;for(d=x=0,N=g-2;0<=N?x<=N:x>=N;d=0<=N?++x:--x){E=b[d],h=b[d+1],l=h.subtract(E);for(v=T=0,C=y-2;0<=C?T<=C:T>=C;v=0<=C?++T:--T){S=w[v],p=w[v+1],c=p.subtract(S),s=this.perCrossing(E,l,S,c),o=s.subtract(h),u=s.subtract(E),a=s.subtract(p),f=s.subtract(S);if(o.length()<=l.length()&&u.length()<=l.length()&&a.length()<=c.length()&&f.length()<=c.length()){if(s.equals(m)){m=s;continue}r&&(i={segment1:l,segmentIndex1:d,segmentStart1:E,segmentEnd1:h,segment2:c,segmentIndex2:v,segmentStart2:S,segmentEnd2:p});if(n.call(this,s,i))return;m=s}}}},t.prototype.perCrossing=function(e,t,n,r){var i,s,o,u,a,f,l;return f=n.x-e.x,l=n.y-e.y,o=f*r.y-l*r.x,u=t.x*r.y-t.y*r.x,a=o/u,i=e.x+t.x*a,s=e.y+t.y*a,new v(i,s)},t}(h),k=function(e){function s(){return s.__super__.constructor.apply(this,arguments)}var t,n,r,i;return M(s,e),c.attachTo(s),t=function(e,t){var n,r,i,s,o;o=[];for(n=i=0,s=t.length;i<s;n=++i)r=t[n],o.push(e[n]=r);return o},n=function(e,t,n,r){var i,s,o,u;return u=(t.y-r.y)*(n.x-r.x)+(n.y-r.y)*(r.x-t.x),i=((e.y-r.y)*(n.x-r.x)+(n.y-r.y)*(r.x-e.x))/u,s=((e.y-t.y)*(r.x-t.x)+(r.y-t.y)*(t.x-e.x))/u,o=((e.y-n.y)*(t.x-n.x)+(t.y-n.y)*(n.x-e.x))/u,i<0||s<0||o<0?!1:!0},r=function(e){var t,n,r,i,s;r=0,t=0,n=e.length;for(t=i=0,s=n-1;0<=s?i<=s:i>=s;t=0<=s?++i:--i)r+=e[t].x*e[(t+1)%n].y-e[(t+1)%n].x*e[t].y;return r/2},i=function(e){var i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S;if(e.length<4)return;h=e,g=function(){var e,t,n;n=[];for(s=e=0,t=h.length;e<t;s=++e)a=h[s],n.push(s);return n}(),p=[],s=0,u=g.length;while(s<u)p[s]=h[g[s]].clone(),++s;c=r(p),i=[],f=[],t(i,g);while(i.length>3){s=0,u=i.length;while(s<u){d=i[s%u],v=i[(s+1)%u],m=i[(s+2)%u],w=h[d],E=h[v],S=h[m],l=!0,o=(s+3)%u;while(o!==s){p=[w,E,S],y=r(p);if(c<0&&y>0||c>0&&y<0||n(h[i[o]],w,E,S)){l=!1;break}o=(o+1)%u}if(l){f.push(d,v,m),i.splice((s+1)%u,1);break}++s}}return f.push.apply(f,i.slice(0,3)),b=!0,f},s.prototype.triangles=function(){var e,t,n,r,s,o,u,a,f,l;if(this.memoized("triangles"))return this.memoFor("triangles");a=this.points(),a.pop(),o=i(a),u=[];for(r=f=0,l=o.length/3-1;0<=l?f<=l:f>=l;r=0<=l?++f:--f)s=r*3,e=a[o[s]],t=a[o[s+1]],n=a[o[s+2]],u.push(new C(e,t,n));return this.memoize("triangles",u)},s}(h),g=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return M(t,e),t.included=function(e){return e.proxyable=function(t,n){var r,i;for(r in n)i=n[r],i.proxyable=t,e.prototype[r]=i;return n}},t}(h),x=function(e){var t;return t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return M(n,t),c.attachTo(n),n.included=function(t){return t.prototype.clone=function(){return new t(this.vertices.map(function(e){return e.clone()}),this.bias)},t.segmentSize=function(){return e}},n.prototype.initSpline=function(e,t){this.vertices=e,this.bias=t!=null?t:20;if(!this.validateVertices(this.vertices))throw new Error("The number of vertices for "+this+" doesn't match")},n.prototype.center=function(){var e,t,n,r,i,s;t=n=0,s=this.vertices;for(r=0,i=s.length;r<i;r++)e=s[r],t+=e.x,n+=e.y;return t/=this.vertices.length,n/=this.vertices.length,new v(t,n)},n.prototype.translate=function(e,t){var n,r,i,s,o,u;o=v.pointFrom(e,t),e=o.x,t=o.y,u=this.vertices;for(n=i=0,s=u.length;i<s;n=++i)r=u[n],this.vertices[n]=r.add(e,t);return this},n.prototype.rotate=function(e){var t,n,r,i,s,o;t=this.center(),o=this.vertices;for(n=i=0,s=o.length;i<s;n=++i)r=o[n],this.vertices[n]=r.rotateAround(t,e);return this},n.prototype.scale=function(e){var t,n,r,i,s,o;t=this.center(),o=this.vertices;for(n=i=0,s=o.length;i<s;n=++i)r=o[n],this.vertices[n]=t.add(r.subtract(t).scale(e));return this},n.prototype.points=function(){var e,t,n;return this.memoized("points")?this.memoFor("points").concat():(n=this.segments()*this.bias,t=function(){var t,r;r=[];for(e=t=0;0<=n?t<=n:t>=n;e=0<=n?++t:--t)r.push(this.pathPointAt(e/n));return r}.call(this),this.memoize("points",t).concat())},n.prototype.validateVertices=function(t){return t.length%e===1&&t.length>=e+1},n.prototype.segments=function(){return this.vertices==null||this.vertices.length===0?0:this.memoized("segments")?this.memoFor("segments"):this.memoize("segments",(this.vertices.length-1)/e)},n.prototype.segmentSize=function(){return e},n.prototype.segment=function(t){var n;return t<this.segments()?(n="segment"+t,this.memoized(n)?this.memoFor(n):this.memoize(n,this.vertices.concat().slice(t*e,(t+1)*e+1))):null},n.prototype.length=function(){return this.measure(this.bias)},n.prototype.measure=function(e){var t,n,r,i;if(this.memoized("measure"))return this.memoFor("measure");n=0;for(t=r=0,i=this.segments()-1;0<=i?r<=i:r>=i;t=0<=i?++r:--r)n+=this.measureSegment(this.segment(t),e);return this.memoize("measure",n)},n.prototype.measureSegment=function(e,t){var n,r,i,s,o;r="segment"+e+"_"+t+"Length";if(this.memoized(r))return this.memoFor(r);s=1/t,i=0;for(n=o=1;1<=t?o<=t:o>=t;n=1<=t?++o:--o)i+=this.pointInSegment((n-1)*s,e).distance(this.pointInSegment(n*s,e));return this.memoize(r,i)},n.prototype.pathPointAt=function(e,t){return t==null&&(t=!0),e<0&&(e=0),e>1&&(e=1),e===0?this.vertices[0]:e===1?this.vertices[this.vertices.length-1]:t?this.walkPathBasedOnLength(e):this.walkPathBasedOnSegments(e)},n.prototype.walkPathBasedOnLength=function(e){var t,n,r,i,s,o,u,a,f;u=0,r=this.length(),s=this.segments();for(t=a=0,f=s-1;0<=f?a<=f:a>=f;t=0<=f?++a:--a){i=this.segment(t),o=this.measureSegment(i,this.bias)/r;if(u+o>e)return n=Math.map(e,u,u+o,0,1),this.pointInSegment(n,i);u+=o}},n.prototype.walkPathBasedOnSegments=function(e){var t,n;return n=this.segments(),e*=n,t=Math.floor(e),t===n&&(t-=1),this.pointInSegment(e-t,this.segment(t))},n.prototype.fill=function(){},n.prototype.drawPath=function(e){var t,n,r,i,s,o;n=this.points(),r=n.shift(),e.beginPath(),e.moveTo(r.x,r.y),o=[];for(i=0,s=n.length;i<s;i++)t=n[i],o.push(e.lineTo(t.x,t.y));return o},n.prototype.drawVertices=function(e,t){var n,r,i,s,o;e.fillStyle=t,s=this.vertices,o=[];for(r=0,i=s.length;r<i;r++)n=s[r],e.beginPath(),e.arc(n.x,n.y,2,0,Math.PI*2),e.fill(),o.push(e.closePath());return o},n.prototype.drawVerticesConnections=function(e,t){var n,r,i,s,o,u;e.strokeStyle=t,u=[];for(n=s=1,o=this.vertices.length-1;1<=o?s<=o:s>=o;n=1<=o?++s:--s)i=this.vertices[n-1],r=this.vertices[n],e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(r.x,r.y),e.stroke(),u.push(e.closePath());return u},n.prototype.memoizationKey=function(){return this.vertices.map(function(e){return""+e.x+";"+e.y}).join(";")},n}(h)},v=function(){function e(e,t){e!=null&&(t=e.y||t),isNaN(t)&&(t=0),e!=null&&(e=e.x||e),isNaN(e)&&(e=0),this.x=e,this.y=t}return L([s("x","y"),o("Point","x","y"),E("geomjs.Point","x","y"),t])["in"](e),e.isPoint=function(e){return e!=null&&e.x!=null&&e.y!=null},e.pointFrom=function(t,n,r){var i;return r==null&&(r=!1),i=t,t!=null&&typeof t=="object"&&(i=t.x,n=t.y),r&&(isNaN(i)||isNaN(n))&&this.notAPoint([i,n]),new e(i,n)},e.polar=function(t,n){return n==null&&(n=1),new e(Math.sin(t)*n,Math.cos(t)*n)},e.interpolate=function(t,n,r){var i,s,o,u,a,f,l,c=this;i=[];for(u=f=0,l=arguments.length;f<l;u=++f)a=arguments[u],i[u]=a;return o=function(t,n){var r;return r=null,c.isPoint(t[0])?r=t.shift():Math.isFloat(t[0])&&Math.isFloat(t[1])?(r=new e(t[0],t[1]),t.splice(0,2)):c.missingPoint(t,n),r},t=o(i,"first"),n=o(i,"second"),r=parseFloat(i.shift()),isNaN(r)&&this.missingPosition(r),s=n.subtract(t),new e(t.x+s.x*r,t.y+s.y*r)},e.missingPosition=function(e){throw new Error("Point.interpolate require a position but "+e+" was given")},e.missingPoint=function(e,t){var n;throw n="Can't find the "+t+" point in Point.interpolate arguments "+e,new Error(n)},e.notAPoint=function(e){throw new Error(""+e+" is not a point")},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.angle=function(){return Math.atan2(this.y,this.x)},e.prototype.angleWith=function(t,n){var r,i;return t==null&&n==null&&this.noPoint("dot"),i=this.isPoint(t),n=i?t.y:n,t=i?t.x:t,(isNaN(t)||isNaN(n))&&e.notAPoint([t,n]),r=this.normalize().dot((new e(t,n)).normalize()),Math.acos(Math.abs(r))*(r<0?-1:1)},e.prototype.normalize=function(t){var n;return t==null&&(t=1),Math.isFloat(t)||this.invalidLength(t),n=this.length(),new e(this.x/n*t,this.y/n*t)},e.prototype.add=function(t,n){return t!=null&&(n=t.y||n),isNaN(n)&&(n=0),t!=null&&(t=t.x||t),isNaN(t)&&(t=0),new e(this.x+t,this.y+n)},e.prototype.subtract=function(t,n){return t!=null&&(n=t.y||n),isNaN(n)&&(n=0),t!=null&&(t=t.x||t),isNaN(t)&&(t=0),new e(this.x-t,this.y-n)},e.prototype.dot=function(t,n){var r;return t==null&&n==null&&this.noPoint("dot"),r=this.isPoint(t),n=r?t.y:n,t=r?t.x:t,(isNaN(t)||isNaN(n))&&e.notAPoint([t,n]),this.x*t+this.y*n},e.prototype.distance=function(t,n){var r;return t==null&&n==null&&this.noPoint("distance"),r=this.isPoint(t),n=r?t.y:n,t=r?t.x:t,(isNaN(t)||isNaN(n))&&e.notAPoint([t,n]),this.subtract(t,n).length()},e.prototype.scale=function(t){return Math.isFloat(t)||this.invalidScale(t),new e(this.x*t,this.y*t)},e.prototype.rotate=function(t){var n,r,i,s;return Math.isFloat(t)||this.invalidRotation(t),r=this.length(),n=Math.atan2(this.y,this.x)+t,i=Math.cos(n)*r,s=Math.sin(n)*r,new e(i,s)},e.prototype.rotateAround=function(e,t,n){var r;return r=this.isPoint(e),r&&(n=t),t=r?e.y:t,e=r?e.x:e,this.subtract(e,t).rotate(n).add(e,t)},e.prototype.isPoint=e.isPoint,e.prototype.pointFrom=e.pointFrom,e.prototype.defaultToZero=function(e,t){return e=isNaN(e)?0:e,t=isNaN(t)?0:t,[e,t]},e.prototype.paste=function(e,t){var n;return e==null&&t==null?this:(n=e!=null&&typeof e=="object",t=n?e.y:t,e=n?e.x:e,isNaN(e)||(this.x=e),isNaN(t)||(this.y=t),this)},e.prototype.noPoint=function(e){throw new Error(""+e+" was called without arguments")},e.prototype.invalidLength=function(e){throw new Error("Invalid length "+e+" provided")},e.prototype.invalidScale=function(e){throw new Error("Invalid scale "+e+" provided")},e.prototype.invalidRotation=function(e){throw new Error("Invalid rotation "+e+" provided")},e}(),l=function(){function n(e,t,n,r,i,s){var o;e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s,!0),this.a=o.a,this.b=o.b,this.c=o.c,this.d=o.d,this.tx=o.tx,this.ty=o.ty}var e;return e=["a","b","c","d","tx","ty"],L([s.apply(null,e),o.apply(null,["Matrix"].concat(e)),E.apply(null,["geomjs.Matrix"].concat(e)),p("matrixFrom",{a:1,b:0,c:0,d:1,tx:0,ty:0}),t])["in"](n),n.isMatrix=function(t){var n,r,i;if(t==null)return!1;for(r=0,i=e.length;r<i;r++){n=e[r];if(!Math.isFloat(t[n]))return!1}return!0},n.prototype.transformPoint=function(e,t){var n,r;if(e==null&&t==null)throw new Error("transformPoint was called without arguments");return r=v.pointFrom(e,t,!0),n=r.x,t=r.y,new v(n*this.a+t*this.c+this.tx,n*this.b+t*this.d+this.ty)},n.prototype.translate=function(e,t){var n,r;return e==null&&(e=0),t==null&&(t=0),r=v.pointFrom(e,t),n=r.x,t=r.y,this.tx+=n,this.ty+=t,this},n.prototype.scale=function(e,t){var n,r;return e==null&&(e=1),t==null&&(t=1),r=v.pointFrom(e,t),n=r.x,t=r.y,this.a*=n,this.d*=t,this.tx*=n,this.ty*=t,this},n.prototype.rotate=function(e){var t,n,r;return e==null&&(e=0),t=Math.cos(e),n=Math.sin(e),r=[this.a*t-this.b*n,this.a*n+this.b*t,this.c*t-this.d*n,this.c*n+this.d*t,this.tx*t-this.ty*n,this.tx*n+this.ty*t],this.a=r[0],this.b=r[1],this.c=r[2],this.d=r[3],this.tx=r[4],this.ty=r[5],this},n.prototype.skew=function(e,t){var n;return n=v.pointFrom(e,t,0),this.append(Math.cos(n.y),Math.sin(n.y),-Math.sin(n.x),Math.cos(n.x))},n.prototype.append=function(e,t,n,r,i,s){var o,u;return e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s,!0),e=o.a,t=o.b,n=o.c,r=o.d,i=o.tx,s=o.ty,u=[e*this.a+t*this.c,e*this.b+t*this.d,n*this.a+r*this.c,n*this.b+r*this.d,i*this.a+s*this.c+this.tx,i*this.b+s*this.d+this.ty],this.a=u[0],this.b=u[1],this.c=u[2],this.d=u[3],this.tx=u[4],this.ty=u[5],this},n.prototype.prepend=function(e,t,n,r,i,s){var o,u,a;e==null&&(e=1),t==null&&(t=0),n==null&&(n=0),r==null&&(r=1),i==null&&(i=0),s==null&&(s=0),o=this.matrixFrom(e,t,n,r,i,s,!0),e=o.a,t=o.b,n=o.c,r=o.d,i=o.tx,s=o.ty;if(e!==1||t!==0||n!==0||r!==1)u=[this.a*e+this.b*n,this.a*t+this.b*r,this.c*e+this.d*n,this.c*t+this.d*r],this.a=u[0],this.b=u[1],this.c=u[2],this.d=u[3];return a=[this.tx*e+this.ty*n+i,this.tx*t+this.ty*r+s],this.tx=a[0],this.ty=a[1],this},n.prototype.identity=function(){var e;return e=[1,0,0,1,0,0],this.a=e[0],this.b=e[1],this.c=e[2],this.d=e[3],this.tx=e[4],this.ty=e[5],this},n.prototype.inverse=function(){var e,t;return e=this.a*this.d-this.b*this.c,t=[this.d/e,-this.b/e,-this.c/e,this.a/e,(this.c*this.ty-this.d*this.tx)/e,-(this.a*this.ty-this.b*this.tx)/e],this.a=t[0],this.b=t[1],this.c=t[2],this.d=t[3],this.tx=t[4],this.ty=t[5],this},n.prototype.isMatrix=function(e){return n.isMatrix(e)},n}(),w=function(){function i(e,t,n,r,i){var s;s=this.defaultToZero(this.rectangleFrom.apply(this,arguments)),this.x=s.x,this.y=s.y,this.width=s.width,this.height=s.height,this.rotation=s.rotation}var e,n,r;return e=["x","y","width","height","rotation"],L([s.apply(null,e),o.apply(null,["Rectangle"].concat(e)),E.apply(null,["geomjs.Rectangle"].concat(e)),p("rectangleFrom",{x:NaN,y:NaN,width:NaN,height:NaN,rotation:NaN}),t,u,T,d,k,g,a])["in"](i),i.eachRectangleRectangleIntersections=function(e,t,n,r){var i,s,o,u;r==null&&(r=!1);if(!e.equals(t))return this.eachIntersections(e,t,n,r);u=e.points();for(s=0,o=u.length;s<o;s++){i=u[s];if(n.call(this,i))return}},n=a.iterators,r="RectangleRectangle",n[r]=i.eachRectangleRectangleIntersections,i.proxyable("PointList",{corners:function(){return[this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft()]}}),i.proxyable("Point",{topLeft:function(){return new v(this.x,this.y)},topRight:function(){return this.topLeft().add(this.topEdge())},bottomLeft:function(){return this.topLeft().add(this.leftEdge())},bottomRight:function(){return this.topLeft().add(this.topEdge()).add(this.leftEdge())}}),i.proxyable("Point",{center:function(){return this.topLeft().add(this.diagonal().scale(.5))},topEdgeCenter:function(){return this.topLeft().add(this.topEdge().scale(.5))},bottomEdgeCenter:function(){return this.bottomLeft().add(this.topEdge().scale(.5))},leftEdgeCenter:function(){return this.topLeft().add(this.leftEdge().scale(.5))},rightEdgeCenter:function(){return this.topRight().add(this.leftEdge().scale(.5))}}),i.proxyable("PointList",{edges:function(){return[this.topEdge(),this.topRight(),this.bottomRight(),this.bottomLeft()]}}),i.proxyable("Point",{topEdge:function(){return new v(this.width*Math.cos(this.rotation),this.width*Math.sin(this.rotation))},leftEdge:function(){return new v(this.height*Math.cos(this.rotation+Math.PI/2),this.height*Math.sin(this.rotation+Math.PI/2))},bottomEdge:function(){return this.topEdge()},rightEdge:function(){return this.leftEdge()},diagonal:function(){return this.leftEdge().add(this.topEdge())}}),i.prototype.top=function(){return Math.min(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},i.prototype.bottom=function(){return Math.max(this.y,this.topRight().y,this.bottomRight().y,this.bottomLeft().y)},i.prototype.left=function(){return Math.min(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},i.prototype.right=function(){return Math.max(this.x,this.topRight().x,this.bottomRight().x,this.bottomLeft().x)},i.prototype.setCenter=function(e,t){var n;return n=v.pointFrom(e,t).subtract(this.center()),this.x+=n.x,this.y+=n.y,this},i.prototype.translate=function(e,t){var n;return n=v.pointFrom(e,t),this.x+=n.x,this.y+=n.y,this},i.prototype.rotate=function(e){var t;return t=this.topLeft().rotateAround(this.center(),e),this.x=t.x,this.y=t.y,this.rotation+=e,this},i.prototype.scale=function(e){var t;return t=this.center(),this.width*=e,this.height*=e,this.setCenter(t),this},i.prototype.rotateAroundCenter=i.prototype.rotate,i.prototype.scaleAroundCenter=i.prototype.scale,i.prototype.inflateAroundCenter=function(e,t){var n;return n=this.center(),this.inflate(e,t),this.setCenter(n),this},i.prototype.inflate=function(e,t){var n;return n=v.pointFrom(e,t),this.width+=n.x,this.height+=n.y,this},i.prototype.inflateLeft=function(e){var t,n;return this.width+=e,t=this.topEdge().normalize(-e),n=this.topLeft().add(t),this.x=n.x,this.y=n.y,this},i.prototype.inflateRight=function(e){return this.width+=e,this},i.prototype.inflateTop=function(e){var t,n;return this.height+=e,t=this.leftEdge().normalize(-e),n=this.topLeft().add(t),this.x=n.x,this.y=n.y,this},i.prototype.inflateBottom=function(e){return this.height+=e,this},i.prototype.inflateTopLeft=function(e,t){var n;return n=v.pointFrom(e,t),this.inflateLeft(n.x),this.inflateTop(n.y),this},i.prototype.inflateTopRight=function(e,t){var n;return n=v.pointFrom(e,t),this.inflateRight(n.x),this.inflateTop(n.y),this},i.prototype.inflateBottomLeft=function(e,t){var n;return n=v.pointFrom(e,t),this.inflateLeft(n.x),this.inflateBottom(n.y),this},i.prototype.inflateBottomRight=function(e,t){return this.inflate(e,t)},i.prototype.closedGeometry=function(){return!0},i.proxyable("PointList",{points:function(){return[this.topLeft(),this.topRight(),this.bottomRight(),this.bottomLeft(),this.topLeft()]}}),i.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(e)*1e4,Math.sin(e)*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},i.prototype.acreage=function(){return this.width*this.height},i.prototype.contains=function(e,t){var n,r;return r=(new v(e,t)).rotateAround(this.topLeft(),-this.rotation),n=r.x,t=r.y,this.x<=n&&n<=this.x+this.width&&this.y<=t&&t<=this.y+this.height},i.prototype.randomPointInSurface=function(e){return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),this.topLeft().add(this.topEdge().scale(e.get())).add(this.leftEdge().scale(e.get()))},i.prototype.length=function(){return this.width*2+this.height*2},i.proxyable("Point",{pathPointAt:function(e,t){var n,r,i,s;return t==null&&(t=!0),s=this.pathSteps(t),n=s[0],r=s[1],i=s[2],e<n?this.topLeft().add(this.topEdge().scale(Math.map(e,0,n,0,1))):e<r?this.topRight().add(this.rightEdge().scale(Math.map(e,n,r,0,1))):e<i?this.bottomRight().add(this.bottomEdge().scale(Math.map(e,r,i,0,1)*-1)):this.bottomLeft().add(this.leftEdge().scale(Math.map(e,i,1,0,1)*-1))}}),i.proxyable("Angle",{pathOrientationAt:function(e,t){var n,r,i,s,o;return t==null&&(t=!0),o=this.pathSteps(t),r=o[0],i=o[1],s=o[2],e<r?n=this.topEdge():e<i?n=this.rightEdge():e<s?n=this.bottomEdge().scale(-1):n=this.leftEdge().scale(-1),n.angle()}}),i.prototype.pathSteps=function(e){var t,n,r,i;return e==null&&(e=!0),e?(t=this.length(),n=this.width/t,r=(this.width+this.height)/t,i=n+r):(n=.25,r=.5,i=.75),[n,r,i]},i.prototype.drawPath=function(e){return e.beginPath(),e.moveTo(this.x,this.y),e.lineTo(this.topRight().x,this.topRight().y),e.lineTo(this.bottomRight().x,this.bottomRight().y),e.lineTo(this.bottomLeft().x,this.bottomLeft().y),e.lineTo(this.x,this.y),e.closePath()},i.prototype.paste=function(e,t,n,i,s){var o,u,a;u=this.rectangleFrom(e,t,n,i,s),a=[];for(r in u)o=u[r],Math.isFloat(o)&&a.push(this[r]=parseFloat(o));return a},i.prototype.defaultToZero=function(e){var t;for(r in e)t=e[r],Math.isFloat(t)||(e[r]=0);return e},i}(),C=function(){function e(e,t,n){var r;r=this.triangleFrom(e,t,n),this.a=r.a,this.b=r.b,this.c=r.c,this.__cache__={}}return L([s("a","b","c"),o("Triangle","a","b","c"),E("geomjs.Triangle","a","b","c"),t,c,u,T,d,a])["in"](e),e.triangleFrom=function(e,t,n){var r;return e!=null&&typeof e=="object"&&!v.isPoint(e)&&(r=e,e=r.a,t=r.b,n=r.c),v.isPoint(e)||this.invalidPoint("a",e),v.isPoint(t)||this.invalidPoint("b",t),v.isPoint(n)||this.invalidPoint("c",n),{a:new v(e),b:new v(t),c:new v(n)}},e.prototype.center=function(){return new v((this.a.x+this.b.x+this.c.x)/3,(this.a.y+this.b.y+this.c.y)/3)},["abCenter","acCenter","bcCenter"].forEach(function(t){var n,r,i;return i=t.split(""),n=i[0],r=i[1],e.prototype[t]=function(){return this[n].add(this[""+n+r]().scale(.5))}}),e.prototype.edges=function(){return[this.ab(),this.bc(),this.ca()]},["ab","ac","ba","bc","ca","cb"].forEach(function(t){var n,r,i;return i=t.split(""),n=i[0],r=i[1],e.prototype[t]=function(){return this[r].subtract(this[n])}}),["abc","bac","acb"].forEach(function(t){var n,r,i,s;return s=t.split(""),n=s[0],r=s[1],i=s[2],e.prototype[t]=function(){return this[""+r+n]().angleWith(this[""+r+i]())}}),e.prototype.top=function(){return Math.min(this.a.y,this.b.y,this.c.y)},e.prototype.bottom=function(){return Math.max(this.a.y,this.b.y,this.c.y)},e.prototype.left=function(){return Math.min(this.a.x,this.b.x,this.c.x)},e.prototype.right=function(){return Math.max(this.a.x,this.b.x,this.c.x)},e.prototype.equilateral=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())&&Math.deltaBelowRatio(this.ab().length(),this.ac().length())},e.prototype.isosceles=function(){return Math.deltaBelowRatio(this.ab().length(),this.bc().length())||Math.deltaBelowRatio(this.ab().length(),this.ac().length())||Math.deltaBelowRatio(this.bc().length(),this.ac().length())},e.prototype.rectangle=function(){var e;return e=Math.PI/2,Math.deltaBelowRatio(Math.abs(this.abc()),e)||Math.deltaBelowRatio(Math.abs(this.bac()),e)||Math.deltaBelowRatio(Math.abs(this.acb()),e)},e.prototype.translate=function(e,t){var n;return n=v.pointFrom(e,t),this.a.x+=n.x,this.a.y+=n.y,this.b.x+=n.x,this.b.y+=n.y,this.c.x+=n.x,this.c.y+=n.y,this},e.prototype.rotate=function(e){var t;return t=this.center(),this.a=this.a.rotateAround(t,e),this.b=this.b.rotateAround(t,e),this.c=this.c.rotateAround(t,e),this},e.prototype.scale=function(e){var t;return t=this.center(),this.a=t.add(this.a.subtract(t).scale(e)),this.b=t.add(this.b.subtract(t).scale(e)),this.c=t.add(this.c.subtract(t).scale(e)),this},e.prototype.rotateAroundCenter=e.prototype.rotate,e.prototype.scaleAroundCenter=e.prototype.scale,e.prototype.closedGeometry=function(){return!0},e.prototype.points=function(){return[this.a.clone(),this.b.clone(),this.c.clone(),this.a.clone()]},e.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(e)*1e4,Math.sin(e)*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},e.prototype.acreage=function(){return this.memoized("acreage")?this.memoFor("acreage"):this.memoize("acreage",this.ab().length()*this.bc().length()*Math.abs(Math.sin(this.abc()))/2)},e.prototype.contains=function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;return a=new v(e,t),c=this.ac(),h=this.ab(),p=a.subtract(this.a),n=c.dot(c),r=c.dot(h),i=c.dot(p),s=h.dot(h),o=h.dot(p),u=1/(n*s-r*r),f=(s*i-r*o)*u,l=(n*o-r*i)*u,f>0&&l>0&&f+l<1},e.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),t=e.get(),n=e.get(),r=this.a.add(this.ab().scale(t)).add(this.ca().scale(n*-1)),this.contains(r)?r:r.add(this.bcCenter().subtract(r).scale(2))},e.prototype.length=function(){return this.ab().length()+this.bc().length()+this.ca().length()},e.prototype.pathPointAt=function(e,t){var n,r,i;return t==null&&(t=!0),i=this.pathSteps(t),n=i[0],r=i[1],e<n?this.a.add(this.ab().scale(Math.map(e,0,n,0,1))):e<r?this.b.add(this.bc().scale(Math.map(e,n,r,0,1))):this.c.add(this.ca().scale(Math.map(e,r,1,0,1)))},e.prototype.pathOrientationAt=function(e,t){var n,r,i;return t==null&&(t=!0),i=this.pathSteps(t),n=i[0],r=i[1],e<n?this.ab().angle():e<r?this.bc().angle():this.ca().angle()},e.prototype.pathSteps=function(e){var t,n,r;return e?(t=this.length(),n=this.ab().length()/t,r=n+this.bc().length()/t):(n=1/3,r=2/3),[n,r]},e.prototype.drawPath=function(e){return e.beginPath(),e.moveTo(this.a.x,this.a.y),e.lineTo(this.b.x,this.b.y),e.lineTo(this.c.x,this.c.y),e.lineTo(this.a.x,this.a.y),e.closePath()},e.prototype.memoizationKey=function(){return""+this.a.x+";"+this.a.y+";"+this.b.x+";"+this.b.y+";"+this.c.x+";"+this.c.y},e.prototype.triangleFrom=e.triangleFrom,e.prototype.invalidPoint=function(e,t){throw new Error("Invalid point "+t+" for vertex "+e)},e}(),e=function(){function n(e,t,n,r){var i;i=this.circleFrom(e,t,n,r),this.radius=i.radius,this.x=i.x,this.y=i.y,this.segments=i.segments}var e;return L([s("x","y","radius"),o("Circle","x","y","radius"),p("circleFrom",{radius:1,x:0,y:0,segments:36}),E("geomjs.Circle","radius","x","y"),c,t,u,T,d,a])["in"](n),n.eachIntersections=function(e,t,n,r){var i,s,o,u,a,f,l,c,h;r==null&&(r=!1),(typeof t.classname=="function"?t.classname():void 0)==="Circle"&&(c=[t,e],e=c[0],t=c[1]),a=t.points(),o=a.length,u=[];for(s=l=0,h=o-2;0<=h?l<=h:l>=h;s=0<=h?++l:--l){f=a[s],i=a[s+1];if(e.eachLineIntersections(f,i,n))return}},n.eachCircleCircleIntersections=function(e,t,n,r){var i,s,o,u,a,f,l,c,h,p,d,m,g,y;r==null&&(r=!1);if(!e.equals(t)){h=e.radius,p=t.radius,l=e.center(),c=t.center(),s=l.distance(c),o=c.subtract(l),d=h+p;if(s>d)return;return s===d?n.call(this,l.add(o.normalize(h))):(i=(h*h-p*p+s*s)/(2*s),u=Math.sqrt(h*h-i*i),a=new v(u*(c.y-l.y)/s,-u*(c.x-l.x)/s),f=l.add(o.normalize(i)).add(a),n.call(this,f),f=l.add(o.normalize(i)).add(a.scale(-1)),n.call(this,f))}y=e.points();for(m=0,g=y.length;m<g;m++){f=y[m];if(n.call(this,f))return}},e=a.iterators,e.Circle=n.eachIntersections,e.CircleCircle=n.eachCircleCircleIntersections,n.prototype.center=function(){return new v(this.x,this.y)},n.prototype.top=function(){return this.y-this.radius},n.prototype.bottom=function(){return this.y+this.radius},n.prototype.left=function(){return this.x-this.radius},n.prototype.right=function(){return this.x+this.radius},n.prototype.translate=function(e,t){var n,r;return r=v.pointFrom(e,t),n=r.x,t=r.y,this.x+=n,this.y+=t,this},n.prototype.rotate=function(){return this},n.prototype.scale=function(e){return this.radius*=e,this},n.prototype.points=function(){var e,t,n,r,i;t=Math.PI*2/this.segments,i=[];for(e=n=0,r=this.segments;0<=r?n<=r:n>=r;e=0<=r?++n:--n)i.push(this.pointAtAngle(e*t));return i},n.prototype.triangles=function(){var e,t,n,r,i,s;if(this.memoized("triangles"))return this.memoFor("triangles");r=[],n=this.points(),e=this.center();for(t=i=1,s=n.length-1;1<=s?i<=s:i>=s;t=1<=s?++i:--i)r.push(new C(e,n[t-1],n[t]));return this.memoize("triangles",r)},n.prototype.closedGeometry=function(){return!0},n.prototype.eachLineIntersections=function(e,t,n){var r,i,s,o,u,a,f,l;r=this.center(),f=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),l=2*((t.x-e.x)*(e.x-r.x)+(t.y-e.y)*(e.y-r.y)),i=r.x*r.x+r.y*r.y+e.x*e.x+e.y*e.y-2*(r.x*e.x+r.y*e.y)-this.radius*this.radius,s=l*l-4*f*i;if(s>0){o=Math.sqrt(s),u=(-l+o)/(2*f),a=(-l-o)/(2*f);if(!(u<0||u>1)||!(a<0||a>1)){if(0<=a&&a<=1&&n.call(this,v.interpolate(e,t,a)))return;0<=u&&u<=1&&n.call(this,v.interpolate(e,t,u))}}},n.prototype.pointAtAngle=function(e){return new v(this.x+Math.cos(e)*this.radius,this.y+Math.sin(e)*this.radius)},n.prototype.acreage=function(){return this.radius*this.radius*Math.PI},n.prototype.contains=function(e,t){var n;return n=v.pointFrom(e,t,!0),this.center().subtract(n).length()<=this.radius},n.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),r=this.pointAtAngle(e.random(Math.PI*2)),t=this.center(),n=r.subtract(t),t.add(n.scale(Math.sqrt(e.random())))},n.prototype.length=function(){return this.radius*Math.PI*2},n.prototype.pathPointAt=function(e){return this.pointAtAngle(e*Math.PI*2)},n.prototype.drawPath=function(e){return e.beginPath(),e.arc(this.x,this.y,this.radius,0,Math.PI*2)},n.prototype.memoizationKey=function(){return""+this.radius+";"+this.x+";"+this.y+";"+this.segments},n}(),i=function(){function n(e,t,n,r,i,s){var o;o=this.ellipsisFrom(e,t,n,r,i,s),this.radius1=o.radius1,this.radius2=o.radius2,this.x=o.x,this.y=o.y,this.rotation=o.rotation,this.segments=o.segments}var e;return e=["radius1","radius2","x","y","rotation","segments"],L([s.apply(null,e),o.apply(null,["Ellipsis"].concat(e)),p("ellipsisFrom",{radius1:1,radius2:1,x:0,y:0,rotation:0,segments:36}),E.apply(null,["geomjs.Ellipsis"].concat(e)),t,c,u,T,d,a])["in"](n),n.prototype.center=function(){return new v(this.x,this.y)},n.prototype.left=function(){return Math.min.apply(Math,this.xBounds())},n.prototype.right=function(){return Math.max.apply(Math,this.xBounds())},n.prototype.bottom=function(){return Math.max.apply(Math,this.yBounds())},n.prototype.top=function(){return Math.min.apply(Math,this.yBounds())},n.prototype.xBounds=function(){var e,t,n=this;return e=this.rotation,t=Math.atan(-this.radius2*Math.tan(e)/this.radius1),[t,t+Math.PI].map(function(t){return n.x+n.radius1*Math.cos(t)*Math.cos(e)-n.radius2*Math.sin(t)*Math.sin(e)})},n.prototype.yBounds=function(){var e,t,n=this;return e=this.rotation,t=Math.atan(this.radius2*(Math.cos(e)/Math.sin(e))/this.radius1),[t,t+Math.PI].map(function(t){return n.y+n.radius1*Math.cos(t)*Math.sin(e)+n.radius2*Math.sin(t)*Math.cos(e)})},n.prototype.translate=function(e,t){var n,r;return r=v.pointFrom(e,t),n=r.x,t=r.y,this.x+=n,this.y+=t,this},n.prototype.rotate=function(e){return this.rotation+=e,this},n.prototype.scale=function(e){return this.radius1*=e,this.radius2*=e,this},n.prototype.points=function(){var e;return this.memoized("points")&&this.memoFor("points").concat(),this.memoize("points",function(){var t,n,r;r=[];for(e=t=0,n=this.segments;0<=n?t<=n:t>=n;e=0<=n?++t:--t)r.push(this.pathPointAt(e/this.segments));return r}.call(this))},n.prototype.triangles=function(){var e,t,n,r,i,s;if(this.memoized("triangles"))return this.memoFor("triangles");r=[],n=this.points(),e=this.center();for(t=i=1,s=n.length-1;1<=s?i<=s:i>=s;t=1<=s?++i:--i)r.push(new C(e,n[t-1],n[t]));return this.memoize("triangles",r)},n.prototype.closedGeometry=function(){return!0},n.prototype.pointAtAngle=function(e){var t,n,r,i;return t=e-this.rotation,r=this.radius1/this.radius2,i=new v(Math.cos(t)*this.radius1,Math.sin(t)*this.radius1),this.radius1<this.radius2&&(i.x=i.x/r),this.radius1>this.radius2&&(i.y=i.y*r),t=i.angle(),n=new v(Math.cos(t)*this.radius1,Math.sin(t)*this.radius2),this.center().add(n.rotate(this.rotation))},n.prototype.acreage=function(){return Math.PI*this.radius1*this.radius2},n.prototype.randomPointInSurface=function(e){var t,n,r;return e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),r=this.pathPointAt(e.get()),t=this.center(),n=r.subtract(t),t.add(n.scale(Math.sqrt(e.random())))},n.prototype.contains=function(e,t){var n,r,i,s,o;return s=new v(e,t),r=this.center(),i=s.subtract(r),n=i.angle(),o=this.pointAtAngle(n),r.distance(o)>=r.distance(s)},n.prototype.length=function(){return Math.PI*(3*(this.radius1+this.radius2)-Math.sqrt((3*this.radius1+this.radius2)*(this.radius1+this.radius2*3)))},n.prototype.pathPointAt=function(e){var t,n;return t=e*Math.PI*2,n=new v(Math.cos(t)*this.radius1,Math.sin(t)*this.radius2),this.center().add(n.rotate(this.rotation))},n.prototype.drawPath=function(e){return e.save(),e.translate(this.x,this.y),e.rotate(this.rotation),e.scale(this.radius1,this.radius2),e.beginPath(),e.arc(0,0,1,0,Math.PI*2),e.closePath(),e.restore()},n.prototype.memoizationKey=function(){return""+this.radius1+";"+this.radius2+";"+this.x+";"+this.y+";"+this.rotation+";"+this.segments},n}(),r=function(){function n(e,t,n,r,i,s,o){var u;u=this.diamondFrom(e,t,n,r,i,s,o),this.topLength=u.topLength,this.rightLength=u.rightLength,this.bottomLength=u.bottomLength,this.leftLength=u.leftLength,this.x=u.x,this.y=u.y,this.rotation=u.rotation}var e;return e=["topLength","rightLength","bottomLength","leftLength","x","y","rotation"],L([o.apply(o,["Diamond"].concat(e)),p("diamondFrom",{topLength:1,rightLength:1,bottomLength:1,leftLength:1,x:0,y:0,rotation:0}),E(["geomjs.Diamond"].concat(e)),s.apply(s,e),t,u,c,T,d,a])["in"](n),n.prototype.center=function(){return new v(this.x,this.y)},n.prototype.topAxis=function(){return(new v(0,-this.topLength)).rotate(this.rotation)},n.prototype.bottomAxis=function(){return(new v(0,this.bottomLength)).rotate(this.rotation)},n.prototype.leftAxis=function(){return(new v(-this.leftLength,0)).rotate(this.rotation)},n.prototype.rightAxis=function(){return(new v(this.rightLength,0)).rotate(this.rotation)},n.prototype.corners=function(){return[this.topCorner(),this.rightCorner(),this.bottomCorner(),this.leftCorner()]},n.prototype.topCorner=function(){return this.center().add(this.topAxis())},n.prototype.bottomCorner=function(){return this.center().add(this.bottomAxis())},n.prototype.leftCorner=function(){return this.center().add(this.leftAxis())},n.prototype.rightCorner=function(){return this.center().add(this.rightAxis())},n.prototype.edges=function(){return[this.topLeftEdge(),this.topRightEdge(),this.bottomRightEdge(),this.bottomLeftEdge()]},n.prototype.topLeftEdge=function(){return this.topCorner().subtract(this.leftCorner())},n.prototype.topRightEdge=function(){return this.rightCorner().subtract(this.topCorner())},n.prototype.bottomLeftEdge=function(){return this.leftCorner().subtract(this.bottomCorner())},n.prototype.bottomRightEdge=function(){return this.bottomCorner().subtract(this.rightCorner())},n.prototype.quadrants=function(){return[this.topLeftQuadrant(),this.topRightQuadrant(),this.bottomRightQuadrant(),this.bottomLeftQuadrant()]},n.prototype.topLeftQuadrant=function(){var e;return e="topLeftQuadrant",this.memoized(e)?this.memoFor(e):this.memoize(e,new C(this.center(),this.topCorner(),this.leftCorner()))},n.prototype.topRightQuadrant=function(){var e;return e="topRightQuadrant",this.memoized(e)?this.memoFor(e):this.memoize(e,new C(this.center(),this.topCorner(),this.rightCorner()))},n.prototype.bottomLeftQuadrant=function(){var e;return e="bottomLeftQuadrant",this.memoized(e)?this.memoFor(e):this.memoize(e,new C(this.center(),this.bottomCorner(),this.leftCorner()))},n.prototype.bottomRightQuadrant=function(){var e;return e="bottomRightQuadrant",this.memoized(e)?this.memoFor(e):this.memoize(e,new C(this.center(),this.bottomCorner(),this.rightCorner()))},n.prototype.top=function(){return Math.min(this.topCorner().y,this.bottomCorner().y,this.leftCorner().y,this.rightCorner().y)},n.prototype.bottom=function(){return Math.max(this.topCorner().y,this.bottomCorner().y,this.leftCorner().y,this.rightCorner().y)},n.prototype.left=function(){return Math.min(this.topCorner().x,this.bottomCorner().x,this.leftCorner().x,this.rightCorner().x)},n.prototype.right=function(){return Math.max(this.topCorner().x,this.bottomCorner().x,this.leftCorner().x,this.rightCorner().x)},n.prototype.translate=function(e,t){var n,r;return r=v.pointFrom(e,t),n=r.x,t=r.y,this.x+=n,this.y+=t,this},n.prototype.rotate=function(e){return this.rotation+=e,this},n.prototype.scale=function(e){return this.topLength*=e,this.bottomLength*=e,this.rightLength*=e,this.leftLength*=e,this},n.prototype.points=function(){var e;return[e=this.topCorner(),this.rightCorner(),this.bottomCorner(),this.leftCorner(),e]},n.prototype.triangles=function(){return this.quadrants()},n.prototype.closedGeometry=function(){return!0},n.prototype.pointAtAngle=function(e){var t,n,r;return t=this.center(),n=t.add(Math.cos(e)*1e4,Math.sin(e)*1e4),(r=this.intersections({points:function(){return[t,n]}}))!=null?r[0]:void 0},n.prototype.acreage=function(){return this.topLeftQuadrant().acreage()+this.topRightQuadrant().acreage()+this.bottomLeftQuadrant().acreage()+this.bottomRightQuadrant().acreage()},n.prototype.contains=function(e,t){return this.center().equals(e,t)||this.topLeftQuadrant().contains(e,t)||this.topRightQuadrant().contains(e,t)||this.bottomLeftQuadrant().contains(e,t)||this.bottomRightQuadrant().contains(e,t)},n.prototype.randomPointInSurface=function(e){var t,n,r,i,s,o,u,a,f,l,c,h,p,d,v;return o=this.acreage(),h=this.topLeftQuadrant(),p=this.topRightQuadrant(),d=this.bottomRightQuadrant(),v=this.bottomLeftQuadrant(),n=h.acreage(),r=p.acreage(),i=d.acreage(),s=v.acreage(),t=n+r+i+s,u=n/t,a=r/t,f=i/t,l=s/t,c=e.get(),c<u?h.randomPointInSurface(e):c<u+a?p.randomPointInSurface(e):c<u+a+f?d.randomPointInSurface(e):v.randomPointInSurface(e)},n.prototype.length=function(){return this.topRightEdge().length()+this.topLeftEdge().length()+this.bottomRightEdge().length()+this.bottomLeftEdge().length()},n.prototype.pathPointAt=function(e,t){var n,r,i,s;return t==null&&(t=!0),s=this.pathSteps(t),n=s[0],r=s[1],i=s[2],e<n?this.topCorner().add(this.topRightEdge().scale(Math.map(e,0,n,0,1))):e<r?this.rightCorner().add(this.bottomRightEdge().scale(Math.map(e,n,r,0,1))):e<i?this.bottomCorner().add(this.bottomLeftEdge().scale(Math.map(e,r,i,0,1))):this.leftCorner().add(this.topLeftEdge().scale(Math.map(e,i,1,0,1)))},n.prototype.pathOrientationAt=function(e,t){var n,r,i,s,o;return t==null&&(t=!0),o=this.pathSteps(t),r=o[0],i=o[1],s=o[2],e<r?n=this.topRightEdge():e<i?n=this.bottomRightEdge():e<s?n=this.bottomLeftEdge().scale(-1):n=this.topLeftEdge().scale(-1),n.angle()},n.prototype.pathSteps=function(e){var t,n,r,i;return e==null&&(e=!0),e?(t=this.length(),n=this.topRightEdge().length()/t,r=n+this.bottomRightEdge().length()/t,i=r+this.bottomLeftEdge().length()/t):(n=.25,r=.5,i=.75),[n,r,i]},n.prototype.memoizationKey=function(){return""+this.x+";"+this.y+";"+this.rotation+";     "+this.topLength+";"+this.bottomLength+";"+this.leftLength+";"+this.rightLength+";"},n}(),m=function(){function e(e){e=this.polygonFrom(e).vertices,e==null&&this.noVertices(),e.length<3&&this.notEnougthVertices(e),this.vertices=e}return L([o("Polygon","vertices"),E("geomjs.Polygon","vertices"),t,u,a,k,T,d])["in"](e),e.polygonFrom=function(e){var t;return e!=null&&typeof e=="object"?(t=Object.prototype.toString.call(e).indexOf("Array")!==-1,t?{vertices:e}:e):{vertices:null}},e.prototype.center=function(){var e,t,n,r,i,s;t=n=0,s=this.vertices;for(r=0,i=s.length;r<i;r++)e=s[r],t+=e.x,n+=e.y;return t/=this.vertices.length,n/=this.vertices.length,new v(t,n)},e.prototype.translate=function(e,t){var n,r,i,s,o;s=v.pointFrom(e,t),e=s.x,t=s.y,o=this.vertices;for(r=0,i=o.length;r<i;r++)n=o[r],n.x+=e,n.y+=t;return this},e.prototype.rotate=function(e){var t,n,r,i,s,o;t=this.center(),o=this.vertices;for(n=i=0,s=o.length;i<s;n=++i)r=o[n],this.vertices[n]=r.rotateAround(t,e);return this},e.prototype.scale=function(e){var t,n,r,i,s,o;t=this.center(),o=this.vertices;for(n=i=0,s=o.length;i<s;n=++i)r=o[n],this.vertices[n]=t.add(r.subtract(t).scale(e));return this},e.prototype.rotateAroundCenter=e.prototype.rotate,e.prototype.scaleAroundCenter=e.prototype.scale,e.prototype.points=function(){var e;return function(){var t,n,r,i;r=this.vertices,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.clone());return i}.call(this).concat(this.vertices[0].clone())},e.prototype.closedGeometry=function(){return!0},e.prototype.pointAtAngle=function(e){var t,n,r,i;return t=this.center(),n=function(e,n){return e.distance(t)-n.distance(t)},r=t.add(Math.cos(e)*1e4,Math.sin(e)*1e4),(i=this.intersections({points:function(){return[t,r]}}))!=null?i.sort(n)[0]:void 0},e.prototype.acreage=function(){var e,t,n,r,i;e=0,i=this.triangles();for(n=0,r=i.length;n<r;n++)t=i[n],e+=t.acreage();return e},e.prototype.contains=function(e,t){var n,r,i,s;s=this.triangles();for(r=0,i=s.length;r<i;r++){n=s[r];if(n.contains(e,t))return!0}return!1},e.prototype.randomPointInSurface=function(e){var t,n,r,i,s,o,u;e==null&&(e=new chancejs.Random(new chancejs.MathRandom)),t=this.acreage(),s=this.triangles(),i=s.map(function(e,n){return e.acreage()/t});for(n=o=0,u=i.length;o<u;n=++o)r=i[n],n>0&&(i[n]+=i[n-1]);return e.inArray(s,i,!0).randomPointInSurface(e)},e.prototype.length=function(){var e,t,n,r,i;t=0,n=this.points();for(e=r=1,i=n.length-1;1<=i?r<=i:r>=i;e=1<=i?++r:--r)t+=n[e-1].distance(n[e]);return t},e.prototype.memoizationKey=function(){return this.vertices.map(function(e){return""+e.x+","+e.y}).join(";")},e.prototype.polygonFrom=e.polygonFrom,e.prototype.noVertices=function(){throw new Error("No vertices provided to Polygon")},e.prototype.notEnougthVertices=function(e){var t;throw t=e.length,new Error("Polygon must have at least 3 vertices, was "+t)},e}(),f=function(){function e(e,t){this.initSpline(e,t)}return L([o("LinearSpline"),E("geomjs.LinearSpline","vertices","bias"),u,d,a,x(1)])["in"](e),e.prototype.points=function(){var e,t,n,r,i;r=this.vertices,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],i.push(e.clone());return i},e.prototype.segments=function(){return this.vertices.length-1},e.prototype.validateVertices=function(e){return e.length>=2},e.prototype.drawVerticesConnections=function(){},e}(),n=function(){function e(e,t){t==null&&(t=20),this.initSpline(e,t)}return L([o("CubicBezier"),E("geomjs.CubicBezier","vertices","bias"),u,d,a,x(3)])["in"](e),e.prototype.pointInSegment=function(e,t){var n;return n=new v,n.x=t[0].x*this.b1(e)+t[1].x*this.b2(e)+t[2].x*this.b3(e)+t[3].x*this.b4(e),n.y=t[0].y*this.b1(e)+t[1].y*this.b2(e)+t[2].y*this.b3(e)+t[3].y*this.b4(e),n},e.prototype.b1=function(e){return(1-e)*(1-e)*(1-e)},e.prototype.b2=function(e){return 3*e*(1-e)*(1-e)},e.prototype.b3=function(e){return 3*e*e*(1-e)},e.prototype.b4=function(e){return e*e*e},e}(),y=function(){function e(e,t){t==null&&(t=20),this.initSpline(e,t)}return L([o("QuadBezier"),E("geomjs.QuadBezier","vertices","bias"),u,d,a,x(2)])["in"](e),e.prototype.pointInSegment=function(e,t){var n;return n=new v,n.x=t[0].x*this.b1(e)+t[1].x*this.b2(e)+t[2].x*this.b3(e),n.y=t[0].y*this.b1(e)+t[1].y*this.b2(e)+t[2].y*this.b3(e),n},e.prototype.b1=function(e){return(1-e)*(1-e)},e.prototype.b2=function(e){return 2*e*(1-e)},e.prototype.b3=function(e){return e*e},e}(),b=function(){function e(e,t){t==null&&(t=20),this.initSpline(e,t)}return L([o("QuintBezier"),E("geomjs.QuintBezier","vertices","bias"),u,d,a,x(4)])["in"](e),e.prototype.pointInSegment=function(e,t){var n;return n=new v,n.x=t[0].x*this.b1(e)+t[1].x*this.b2(e)+t[2].x*this.b3(e)+t[3].x*this.b4(e)+t[4].x*this.b5(e),n.y=t[0].y*this.b1(e)+t[1].y*this.b2(e)+t[2].y*this.b3(e)+t[3].y*this.b4(e)+t[4].y*this.b5(e),n},e.prototype.b1=function(e){return(1-e)*(1-e)*(1-e)*(1-e)},e.prototype.b2=function(e){return 4*e*(1-e)*(1-e)*(1-e)},e.prototype.b3=function(e){return 6*e*e*(1-e)*(1-e)},e.prototype.b4=function(e){return 4*e*e*e*(1-e)},e.prototype.b5=function(e){return e*e*e*e},e}(),S=function(){function r(e,t,n,r,i,s,o){var u;u=this.spiralFrom(e,t,n,r,i,s,o),this.radius1=u.radius1,this.radius2=u.radius2,this.twirl=u.twirl,this.x=u.x,this.y=u.y,this.rotation=u.rotation,this.segments=u.segments}var e,n;return e=["radius1","radius2","twirl","x","y","rotation","segments"],L([s.apply(null,e),o.apply(null,["Spiral"].concat(e)),p("spiralFrom",{radius1:1,radius2:1,twirl:1,x:0,y:0,rotation:0,segments:36}),E.apply(null,["geomjs.Spiral"].concat(e)),t,c,u,d,a])["in"](r),r.prototype.center=function(){return new v(this.x,this.y)},r.prototype.ellipsis=function(){return this.memoized("ellipsis")?this.memoFor("ellipsis"):this.memoize("ellipsis",new i(this))},r.prototype.translate=function(e,t){var n;return n=v.pointFrom(e,t),e=n.x,t=n.y,this.x+=e,this.y+=t,this},r.prototype.rotate=function(e){return this.rotation+=e,this},r.prototype.scale=function(e){return this.radius1*=e,this.radius2*=e,this},r.prototype.points=function(){var e,t,n,r,i,s,o;if(this.memoized("points"))return this.memoFor("points").concat();i=[],e=this.center(),t=this.ellipsis();for(n=s=0,o=this.segments;0<=o?s<=o:s>=o;n=0<=o?++s:--s)r=n/this.segments,i.push(this.pathPointAt(r));return this.memoize("points",i)},r.prototype.pathPointAt=function(e,t){var n,r,i,s,o,u;return t==null&&(t=!0),i=this.center(),s=this.ellipsis(),n=Math.PI*2,r=this.rotation+e*n*this.twirl%n,o=(u=s.pointAtAngle(r))!=null?u.subtract(i).scale(e):void 0,i.add(o)},r.prototype.fill=function(){},r.prototype.drawPath=function(e){var t,n,r,i,s,o;n=this.points(),r=n.shift(),e.beginPath(),e.moveTo(r.x,r.y),o=[];for(i=0,s=n.length;i<s;i++)t=n[i],o.push(e.lineTo(t.x,t.y));return o},n=function(){return""+this.radius1+";"+this.radius2+";"+this.twirl+";"+this.x+";"+this.y+";"+this.rotation+";"+this.segments},r}(),N=function(){function e(e,t){this.geometry=e,this.matrix=t,this.proxiedMethods=this.detectProxyableMethods(this.geometry)}return e.defineProxy=function(e,t){switch(t){case"PointList":return this.prototype[e]=function(){var t,n=this;return t=this.geometry[e].apply(this.geometry,arguments),this.matrix!=null?t.map(function(e){return n.matrix.transformPoint(e)}):t};case"Point":return this.prototype[e]=function(){var t;return t=this.geometry[e].apply(this.geometry,arguments),this.matrix!=null?this.matrix.transformPoint(t):t};case"Angle":return this.prototype[e]=function(){var t,n;return t=this.geometry[e].apply(this.geometry,arguments),this.matrix!=null?(n=new v(Math.cos(t),Math.sin(t)),this.matrix.transformPoint(n).angle()):t}}},e.prototype.proxied=function(){var e,t,n,r;n=this.proxiedMethods,r=[];for(e in n)t=n[e],r.push(e);return r},e.prototype.detectProxyableMethods=function(t){var n,r,i,s;r={},s=t.constructor.prototype;for(n in s)i=s[n],i.proxyable&&(r[n]=i.proxyable,e.defineProxy(n,i.proxyable));return r},e}(),this.geomjs.include=L,this.geomjs.Mixin=h,this.geomjs.Equatable=s,this.geomjs.Formattable=o,this.geomjs.Cloneable=t,this.geomjs.Sourcable=E,this.geomjs.Memoizable=c,this.geomjs.Parameterizable=p,this.geomjs.Geometry=u,this.geomjs.Surface=T,this.geomjs.Path=d,this.geomjs.Intersections=a,this.geomjs.Triangulable=k,this.geomjs.Proxyable=g,this.geomjs.Spline=x,this.geomjs.Point=v,this.geomjs.Matrix=l,this.geomjs.Rectangle=w,this.geomjs.Triangle=C,this.geomjs.Circle=e,this.geomjs.Ellipsis=i,this.geomjs.Diamond=r,this.geomjs.Polygon=m,this.geomjs.LinearSpline=f,this.geomjs.CubicBezier=n,this.geomjs.QuadBezier=y,this.geomjs.QuintBezier=b,this.geomjs.Spiral=S,this.geomjs.TransformationProxy=N}).call(this)